<% content_for :page_title do -%>example.com<% end -%>
<% content_for :content_header do -%>
<div class="page-header">
  <div class="pull-right">
    <%= link_to "Edit &rarr;".html_safe, edit_app_path(@app), :class => "btn large primary" -%>
  </div>

  <h1><%= @app.name%>
    <small><%= @platforms.map(&:name).join(' &bull; ').html_safe%></small>
    <span class="label warning">unverified</span>
  </h1>
</div> 

<% end -%>

<% content_for :include_js do %>
<script type="text/javascript">
$(document).ready(function() {
	Signalike.Source.top({
		dimension: <%= @app.id %>,
		success: function (sources) {
			var source   = $("#_post").html();
			var template = Handlebars.compile(source);
			//sources.items is the list of sources
			//sources.total is the number of sources in the list
			var compiled = [];
			var limit = 4;
			var i;
			limit = Math.min(limit,sources.items.length);
			for(var x = 0; x < limit; x++) {
				i = sources.items[x];
				compiled.push(template(i) );
			}
			
			$('#top_sources').html(compiled.join(''));
			
			console.log(sources);
			console.log($("#pagination"))
			$("#pagination").html('<ul><li class="prev disabled"><a href="#">&larr; Previous</a></li><li class="active"><a href="#">1</a></li><li><a href="#">2</a></li><li><a href="#">3</a></li><li class="next"><a href="#">Next &rarr;</a></li></ul>');
			//get the handlebar template
			source   = $("#_post").html();
			template = Handlebars.compile(source);
			//sources.items is the list of sources
			//sources.total is the number of sources in the list
			compiled = [];
			$.each(sources.items, function (idx, i) {
				compiled.push(template(i));
				// (new Signalike.Source(i.id)).fetch({
				// 	success: function (d) {
				// 		console.log(d);
				// 		
				// 	}
				// });
			});
			
			$('#latest_sources_list').html(compiled.join(''));
		}
	});
	
});
</script>
<% end %>
<%= render partial: 'shared/handlebars/post'%>


<div class="span7 pull-left">
  <h2>About</h2>
  <p><em>Updated <%= time_ago_in_words(@app.updated_at) %> ago by <%= @app.try(:user_id) or "Unknown" %></em></p>
  <ul class="media-grid">
    <li>
      <a href="#">
        <img class="thumbnail" src="http://placehold.it/105x105" alt="">
      </a>
    </li>  
    <li>
      <a href="/apps/1-example-com">
        <img class="thumbnail" src="http://placehold.it/105x105" alt="">
      </a>
    </li>
    <li>
      <a href="/apps/1-example-com">
        <img class="thumbnail" src="http://placehold.it/105x105" alt="">
      </a>
    </li>    
  </ul>
  <p><%= truncate(@app.about, :length => 50,:omission => "... <a href="">more &dArr;</a>").html_safe %></p>
  
  <h3>Thanks To</h3>
  <p><%= truncate(@app.thanks_to, :length => 50, :omission => "... more <a href="">more &dArr;</a>").html_safe %></p>
  <h3>Links</h3>
  <address>
	<% if @app.website.presence %>
    <strong>Web Site</strong><br>
	<%= link_to @app.website, @app.website %>
    <br>
    <% end %>
	<% if @app.twitter.presence %>
    <strong>Twitter</strong><br>
    <%= link_to ['@',@app.twitter].join, ["http://twitter.com", '/', @app.twitter].join %>
    <a href="">@<%= @app.twitter%></a><br>
    <% end %>
    <strong>Facebook</strong><br>
    <a href="">http://www.facebook.com/example</a><br>
    <strong>Google+</strong><br>
    <a href="">http://plus.google.com/...</a><br>
    <strong>iTunes App Store</strong><br>
    <a href="">http://itunes.apple.com/...</a>
  </address>
  <h3>Other Documents</h3>
  <ul>
    <li><a href="">Architecture Overview.pptx</a></li>
    <li><a href="">Conference Presentation.pptx</a></li>
  </ul>
</div>

<div class="span8 pull-right">
  <div class="pull-right">
    <a href="#" data-controls-modal="modal-add-post" data-backdrop="static" class="btn small primary">Add Post</a>
  </div>
  
  <h2>Posts <small>page 1 of 3 &bull; 30 posts</small></h2>
  <ul class="pills">
    <li class="active"><a href="#">Popular</a></li>
    <li><a href="#">Recent</a></li>
    <li><a href="#">Files</a></li>
    <li><a href="#">Links</a></li>
    <li><a href="#">Questions</a></li>
  </ul>  
  <div id="top_sources">
	Loading...
  </div>

  <div id="pagination" class="pagination">
   
  </div>   
</div>

<div id="modal-add-post" class="modal hide fade" style="display: none; ">
  <div class="modal-header">
    <a href="#" class="close">Ã—</a>
    <h3>Add Post</h3>
  </div>
  <div class="modal-body">
    <form>
      <fieldset>
        <div class="clearfix">
          <label for="xlInput">Title *</label>
          <div class="input">
            <input class="span5" id="xlInput" name="xlInput" size="30" type="text">
          </div>
        </div><!-- /clearfix -->
        <div class="clearfix">
          <label for="prependedInput">Link</label>
          <div class="input">
            <input class="span5" id="prependedInput" name="prependedInput" size="16" type="text" placeholder="">
          </div>
        </div>        
        <div class="clearfix">
          <label for="fileInput">Files</label>
          <div class="input">
            <input class="input-file" id="fileInput" name="fileInput" type="file">
          </div>
        </div><!-- /clearfix -->        
        <div class="clearfix">
          <label for="textarea">Text</label>
          <div class="input">
            <textarea class="span6" id="textarea2" name="textarea2" rows="12"></textarea>
          </div>
        </div><!-- /clearfix -->        
      </fieldset>
    </form>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn primary">Save</a>
    <a href="#" class="btn secondary">Preview</a>
  </div>
</div>

